---
layout: default
---

# 云端高性能技术架构浅析
2015.04.04

### 1. 基本技术

无论是国外的Google、Facebook、Amazon，还是国内的Baidu、Taobao等，这些高性能的服务器在处理高并发的请求时，都能快速、准确的给予应答。通过查阅资料，了解现有大型网站的技术架构，发现目前常用的技术有分层、缓存、负载均衡、数据库性能优化，分布式系统等等。接下类分别对这些技术进行简单介绍。

#### 1.1 分层与服务分离

　　无论OSI的7层网络结构，还是计算机底层硬件与上层软件之间的分层，甚至于Web领域大家非常熟悉的MVC开发模式，分层在计算机领域无处不在。分层可以将不同的功能部件独立起来，下层为上层提供访问接口，支撑上层的功能；上层调用下层接口来完成服务。

　　分层也是服务器端采用的一种方法，通过将数据库、文件资源等与应用服务器分开，可以缓解服务器压力。

　　另外，根据业务需求的不同，将明显没有交集的业务分开，独立成不同的模块单独进行管理，也可以在很大程度上提升服务器性能。

#### 1.2 缓存

　　缓存在计算机很多地方都有涉及，比如在内存与硬盘之间增加Cache、增加IO缓冲区来缓解速度之间的不匹配。缓存的出现主要是依据计算机中著名的二八定律。缓存的技术主要包括本地缓存、分布式缓存、CDN和反向代理。

　　根据二八定律，80%的操作集中在20%的数据上。网站将常用的数据缓存在本地应用服务器中，以后直接通过缓存中的数据来响应用户的请求，而不用再去计算。这样就可以减少响应时间。

　　分布式缓存相比本地缓存速度要慢，因为应用服务器要访问专门的缓存服务器来获取数据，但是应用服务器主要用于处理请求，其自身内存有限，如果缓存大量数据，应用程序的运行速度将受到明显影响。因此很多大型网站都使用远程分布式缓存，部署大内存的服务器作为专门的缓存服务器。

　　缓存的另外两种表现形式是CDN和反向代理。不同的地方在于，CDN部署在网络提供商（比如电信、移动、联通等）的机房，用户在请求网站服务时，可以直接从网络提供商机房获取数据；而反向代理则部署在网站的中心机房，当用户的请求到中心机房后，首先访问的服务器是反向代理服务器，如果反向代理服务器中有相应资源的缓存，就将其直接返回给用户，而不用再去请求应用服务器。

#### 1.3 负载均衡

　　负载均衡的原理就是去中心化。当用户并发请求量巨大时，如果将所有的请求都交给一个服务器去处理，很可能造成服务器宕机，即使能够正确响应，响应时间也可能会比较长，给用户造成不好的体验。

　　大型网站都是将一个域名绑定不同的服务器IP，这样表面上好像只有一台服务器在提供服务，实际则是一个服务器集群在提供相同的服务。负载均衡器接收所有用户的请求，再根据每台应用服务器正在处理的请求数量来对请求进行分配。这样就能在很大程度上提高系统的性能，同时扩展性也得到很大提升——当某台服务器宕机时，直接替换就可以，其它服务器继续相应用户请求；当用户请求量超过预定峰值时，也可以通过实时增加服务器来缓解压力。

#### 1.4 数据库性能优化

　　使用缓存后，大部分的数据操作不需要通过数据库即可完成。但是仍有一部分读操作（缓存访问不命中，缓存过期）和全部的写操作需要访问数据库，在网站的用户达到一定规模时，数据库因为负载压力过高而成为网站的瓶颈。因而需要对数据库进行优化，常用的技术主要包括读写分离、结合非关系型数据库使用、分布式数据库等。

　　一般情况下，数据库读操作所需要的时间比写操作的要少很多，通过将数据库的读写操作分离可以明显改善数据库性能。目前很多大型网站都配置数据库主从关系，主数据库用于写操作并将数据同步更新到从数据库上，从数据库只负责读操作。例如，新浪云计算平台（SAE）给用户的数据库就进行了主从配置。

　　同时，可以利用非关系型数据库和搜索引擎对数据检索的优势，来减轻应用服务器直接访问关系型数据库的压力。

　　当对业务进行分离后，可以根据业务所涉及的数据，将数据库进行分库部署在不同的服务器上。

#### 1.5 冗余

　　网站需要7x24小时连续运行，但是服务器随时可能出现故障，特别是服务器规模比较大时，出现某台服务器宕机是必然事件。要想保证在服务器宕机的情况下网站依然可以继续服务，不丢失数据，就需要一定程度的服务器冗余运行，数据冗余备份，这样当某台服务器宕机时，可以将其上的服务和数据转移到其它机器上继续运行。