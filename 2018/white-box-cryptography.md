---
layout: default
---

## White-box-cryptography
2018.06.24

术语说明：
* 业务密钥DEK（Data Encryption Key）：具体加密数据的密钥
* 中间密钥KEK（Key Encryption Key）：用于包含DEK（或KEK）的密钥
* 根密钥HUK（Hardware Unique Key）：硬件唯一密钥

白盒密码的作用是保护密钥，对于一个密码算法而言，密钥DEK才是保证数据机密性的关键，保证了DEK的安全性则可以基本上保证数据的机密性（严格意义上一个密钥的使用次数是有要求的），那密钥的管理则成了一个关键点。

密钥管理一般有两种方法：1）通过中间密钥KEK对DEK再次进行加密，由KEK来保证DEK的机密性。但如此则陷入一个循环，因为KEK本身也需要保护。实际应用系统中，往往存在硬件唯一密钥HUK，用于保护中间密钥KEK；KEK再直接参与对DEK的保护，或者先保护另外一个KEK'之后再由KEK'保护DEK。硬件根密钥只能在硬件中访问，这样就保证了根密钥的安全性，进而层级的保证KEK以及DEK的安全性。2）白盒密码的方法，白盒密码是一种软件保护密钥的方式，在无权访问硬件的第三方业务中使用较多。其基本思想是将密钥融入可逆的置换中，在提供加解密正常功能的前提下，保证密钥不可知。对于一个给定的算法，在密钥确定的情况，明文空间和密文空间是一个确定的双射（即给定一个明文即可确定对应的密文，反之亦然）。基于这样的前提，理论上可以构造一个双射查找表用于加解密——给定明文，根据表格查找对应的密文；给定密文，根据表格解密得到对应的明文。但一般算法的明文空间都非常巨大，以分组密码为例，常见的明文空间也有2^64（IOT场景可能较短）。如果全部存储需要的空间则是2^64x2x64比特，也就是2^68字节。这是一个非常巨大的数字，就算可以存储，在实际应用场景中也是不可行的。实际采用的方法是通过一个可逆置换对密钥进行隐藏，在涉及到密钥异或的操作时，通过置换完成。其中一个置换用于加密，其逆置换用于解密，这样就保证加解密的可逆。由于要保证密钥的机密性，因此可逆置换本身也必须是保密的，相当于加了一个秘密因子来保证原始密钥机密；也正因为如此，一个密钥下的白盒密码实现可以有很多种。白盒密码的加解密速度比正常的速度要慢很多，同时也需要消耗较大的存储用于保存查找表。
